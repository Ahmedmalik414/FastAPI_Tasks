<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FastAPI Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #333; }
        input, button, textarea { padding: 5px; margin: 5px 0; }
        #chat { border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 5px; margin-bottom: 10px; }
        .section { margin-bottom: 40px; }
    </style>
</head>
<body>

    <!-- Home / Status -->
    <div class="section">
        <h2>Home / Status</h2>
        <button onclick="checkStatus()">Check Server Status</button>
        <p id="status"></p>
    </div>

    <!-- WebSocket Chat -->
    <div class="section">
        <h2>Real-time Chat</h2>
        <div id="chat"></div>
        <input id="chatMsg" placeholder="Type a message">
        <button onclick="sendChatMessage()">Send</button>
    </div>

    <!-- File Download (Streaming Large Files) -->
    <div class="section">
        <h2>Download Large File</h2>
        <button onclick="downloadFile()">Download File</button>
        <p id="fileStatus"></p>
    </div>

    <!-- Feedback Form (POST example) -->
    <div class="section">
        <h2>Feedback Form</h2>
        <input id="name" placeholder="Your Name"><br>
        <textarea id="feedback" placeholder="Your Feedback"></textarea><br>
        <button onclick="sendFeedback()">Submit Feedback</button>
        <p id="feedbackStatus"></p>
    </div>

<script>
    // 1️⃣ Check server status (GET request)
    async function checkStatus() {
        const response = await fetch('/status');
        const data = await response.json();
        document.getElementById('status').textContent = data.message;
    }

    // 2️⃣ WebSocket Chat
    const ws = new WebSocket("ws://127.0.0.1:8000/ws/chat");
    ws.onmessage = function(event) {
        const chatBox = document.getElementById('chat');
        const p = document.createElement('p');
        p.textContent = event.data;
        chatBox.appendChild(p);
        chatBox.scrollTop = chatBox.scrollHeight; // scroll to bottom
    };

    function sendChatMessage() {
        const input = document.getElementById("chatMsg");
        ws.send(input.value);
        input.value = "";
    }

    // 3️⃣ Download large file
    async function downloadFile() {
        document.getElementById('fileStatus').textContent = "Downloading...";
        const response = await fetch('/download');
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'large_file.zip'; // change filename if needed
        a.click();
        window.URL.revokeObjectURL(url);
        document.getElementById('fileStatus').textContent = "Download completed!";
    }

    // 4️⃣ Send feedback (POST request)
    async function sendFeedback() {
        const name = document.getElementById('name').value;
        const feedback = document.getElementById('feedback').value;

        const response = await fetch('/feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, feedback })
        });

        const data = await response.json();
        document.getElementById('feedbackStatus').textContent = data.message;

        // Clear inputs
        document.getElementById('name').value = '';
        document.getElementById('feedback').value = '';
    }
</script>

</body>
</html>
